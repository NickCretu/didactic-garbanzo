---
interface AccordionItem {
  question: string;
  answer: string;
}

interface Props {
  items: AccordionItem[];
  class?: string;
}

const { items, class: className = '' } = Astro.props;
---

<div class={`accordion space-y-3 ${className}`} role="region">
  {items.map((item, index) => (
    <div class="accordion-item bg-surface rounded-2xl overflow-hidden">
      <button
        class="accordion-trigger w-full flex items-center justify-between p-5 text-left text-body font-medium text-primary hover:bg-gray-100 transition-colors focus:outline-none focus-visible:ring-2 focus-visible:ring-accent focus-visible:ring-inset"
        aria-expanded="false"
        aria-controls={`accordion-content-${index}`}
        id={`accordion-trigger-${index}`}
      >
        <span>{item.question}</span>
        <svg
          class="accordion-icon w-5 h-5 text-muted transition-transform duration-300 flex-shrink-0 ml-4"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
        </svg>
      </button>
      <div
        class="accordion-content hidden"
        id={`accordion-content-${index}`}
        aria-labelledby={`accordion-trigger-${index}`}
        role="region"
      >
        <div class="px-5 pb-5 text-body text-muted">
          {item.answer}
        </div>
      </div>
    </div>
  ))}
</div>

<script>
  function initAccordion() {
    const accordions = document.querySelectorAll('.accordion');
    
    accordions.forEach((accordion) => {
      const triggers = accordion.querySelectorAll('.accordion-trigger');
      
      triggers.forEach((trigger) => {
        trigger.addEventListener('click', () => {
          const isExpanded = trigger.getAttribute('aria-expanded') === 'true';
          const content = accordion.querySelector(`#${trigger.getAttribute('aria-controls')}`);
          const icon = trigger.querySelector('.accordion-icon');
          
          // Toggle current item
          trigger.setAttribute('aria-expanded', (!isExpanded).toString());
          content?.classList.toggle('hidden');
          icon?.classList.toggle('rotate-180');
        });
        
        // Keyboard navigation
        trigger.addEventListener('keydown', (e) => {
          const event = e as KeyboardEvent;
          if (event.key === 'Enter' || event.key === ' ') {
            event.preventDefault();
            (trigger as HTMLElement).click();
          }
        });
      });
    });
  }
  
  // Initialize on page load
  initAccordion();
  
  // Reinitialize on Astro page transitions
  document.addEventListener('astro:page-load', initAccordion);
</script>

<style>
  .accordion-content {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.3s ease-out;
  }
  
  .accordion-content:not(.hidden) {
    max-height: 500px;
  }
</style>
